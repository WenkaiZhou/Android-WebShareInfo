# Android-WebShareInfo
è·å–WebViewä¸­H5çš„åˆ†äº«(å¼€æ”¾å†…å®¹)ä¿¡æ¯

## å¾®ä¿¡H5é“¾æ¥å¡

<img src="https://raw.githubusercontent.com/xuehuayous/Android-WebShareInfo/master/app/pic/1607677503515.jpg" width="300" />

åŒæ ·æ˜¯ä¸¤ç‰‡H5æ–‡ç« ï¼Œåœ¨æ ·å¼æ˜¾ç¤ºä¸Šä¸ºå•¥åŒºåˆ«é‚£ä¹ˆå¤§å‘¢ï¼Ÿæ˜æ˜¾äº²ç”Ÿçš„å…¬ä¼—å·æ–‡ç« æ›´å¥½çœ‹ä¸€äº›ï¼Ÿå®ƒä»¬è‚¯å®šæ˜¯åœ¨H5ä¸Šæœ‰å·®å¼‚çš„ï¼Œå¸¦ç€è¿™ä¸ªç–‘é—®ï¼Œæ‰“å¼€äº†ç¬¬ä¸€ç¯‡æ–‡ç« çš„æºç ã€‚æœç„¶ï¼Œè¿™ä¸€æ®µçœ‹ç€æ¯”è¾ƒå¯ç–‘ã€‚

```html
<meta property="og:title" content="ç”·æœ‹å‹èƒ¸å¤§ï¼Œå¯¹å¥³ç”Ÿæœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ" />
<meta property="og:url" content="http://mp.weixin.qq.com/s?__biz=MzA3MzUzOTg1Nw==&amp;mid=2653781537&amp;idx=2&amp;sn=20c72d6caf2a200b1206a216fcc8859b&amp;chksm=84d4565fb3a3df494bb0357e05ba8c776882fbb3f0d220a27ff679347fd94ad3b55ebf459922#rd" />
<meta property="og:image" content="http://mmbiz.qpic.cn/mmbiz_jpg/iaJ2Y8kZ6cicVUDRLic6QxVnXweRJ9YqTjarF9icqBkpkUSicibXEIOGfWia1RJOWuqoIv7RP6Sava287KnAaqFAibnb3Q/0?wx_fmt=jpeg" />
<meta property="og:description" content="é‡‡è®¿äº†å¤§èƒ¸ç”·å‹çš„å¥³ç”Ÿï¼Œæ•…äº‹å¾ˆå¤šâ€¦â€¦" />
<meta property="og:site_name" content="å¾®ä¿¡å…¬ä¼—å¹³å°" />
<meta property="og:type" content="article" />
<meta property="og:article:author" content="ğŸ»" />
```

å®ƒä»¬éƒ½å¸¦æœ‰ä¸€ä¸ª`og`æ ‡è¯†ï¼Œå¯¹å‰ç«¯å¼€å‘ä¸ç†Ÿæ‚‰çš„æˆ‘æ„Ÿè§‰åº”è¯¥æ˜¯ä¸ªä»€ä¹ˆåè®®ï¼Œæœç´¢ä¸€æŠŠã€‚Open Graph Protocolï¼Œå³å¼€æ”¾å†…å®¹åè®®ï¼Œç”¨äº†`og`æ ‡ç­¾ï¼Œå°±æ˜¯ä½ åŒæ„äº†ç½‘é¡µå†…å®¹å¯ä»¥è¢«å…¶ä»–ç¤¾ä¼šåŒ–ç½‘ç«™å¼•ç”¨ï¼Œè¯´ç™½äº†ï¼Œè¿™ä¸ªå±æ€§çš„åŠ å…¥èƒ½è®©ç”¨æˆ·çš„é¡µé¢å†…å®¹èƒ½æ­£ç¡®çš„åˆ†äº«ï¼Œè¿™æ ·ç½‘é¡µå†…å®¹çš„ä¼ æ’­ã€æ¨å¹¿å°±æ›´åŠ æœ‰åŠ›ã€‚

åŸæ¥å¦‚æ­¤ï¼ŒçœŸæ˜¯ä¸ªå¥½ä¸œè¥¿å‘¢ã€‚çªç„¶æƒ³èµ·æ¥ï¼Œäº§å“åŒå­¦å’Œæˆ‘èŠçš„ï¼Œè¿è¥è®¡åˆ’åœ¨æ˜¥èŠ‚æœŸé—´å‘èµ·å¥½å‹åˆ†äº«æ‹‰æ–°çš„æ´»åŠ¨ï¼Œèƒ½ä¸èƒ½æŠŠæˆ‘ä»¬çš„æ‹‰æ–°ç½‘é¡µåœ¨appå†…åˆ†äº«åˆ°å¾®ä¿¡ã€‚é‚£å²‚ä¸æ˜¯æ­£å¥½å¯ä»¥ä½¿ç”¨è¿™ç§åè®®ï¼Œè·å–ä¿¡æ¯å‘¢ã€‚

## Androidå¦‚ä½•è·å–å†…å®¹å€¼

å“ªæ€ä¹ˆè·å–å¯¹åº”çš„å†…å®¹å‘¢ï¼Ÿåˆæ˜¯ä¸€æŠŠæœç´¢ã€‚çœ‹åˆ°æœ‰äººæè®®ä½¿ç”¨Jsoupè§£æï¼ŒJsoupæˆ‘æ¯”è¾ƒç†Ÿæ‚‰ï¼Œåœ¨ç”¨Javaçˆ¬ç½‘ç«™çš„æ—¶å€™ç”¨è¿‡ï¼Œæ˜¯ä¸€æŠŠè§£æHtmlçš„å¥½æ‰‹ï¼Œä½†...ç”¨æ¥å¹²è¿™ä¸ªï¼Œæœªå…å¤§æå°ç”¨äº†ã€‚

é‚£æ˜¯ä¸æ˜¯å¯ä»¥Nativeè°ƒç”¨H5æ–¹æ³•å‘¢ï¼Ÿ

```kotlin
webView.evaluateJavascript(
    """
    (function () {
        var metas = document.getElementsByTagName('meta');
        for (var i = 0; i < metas.length; i++) {
            if (metas[i].getAttribute("property") == "og:title") {
                return metas[i].getAttribute("content");
            }
        }
        return "";
    })()
    """.trimIndent()
) { title ->
    Log.d("è·å–Title", "title = $title")
}
```

è¿è¡Œï¼Œè§è¯å¥‡è¿¹ï½

```bash
2020-12-11 00:23:57.200 6337-6337/com.kevin.webshareinfo.sample D/è·å–Title: title = "ç”·æœ‹å‹èƒ¸å¤§ï¼Œå¯¹å¥³ç”Ÿæœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ"
```

å“ˆå“ˆï¼Œæ­£ç¡®è¾“å‡ºäº†titleï¼Œç¬¬ä¸€ç‰ˆï¼Œå®Œæˆäº†ã€‚

åœ¨ä»£ç é‡Œçœ‹åˆ°è¿™ä¹ˆä¸€å †ä»£ç è¿˜æ˜¯æŒºğŸ¤®çš„ï¼Œè€Œä¸”æˆ‘ä»¬éœ€è¦çš„ä¿¡æ¯ä¸åªæœ‰ `title` è¿˜æœ‰ `url` `image` `description` `site_name` `type` è¿™äº›ä¿¡æ¯ï¼Œå°±ç®€å•å°è£…ä¸‹å§ã€‚

## å¼•å…¥

```groovy
implementation 'com.kevin:webshareinfo:1.0.0'
```

## ä½¿ç”¨

```kotlin
webView.getShareInfo { info ->
    Log.d("shareInfo", "title = ${info.title}")
    Log.d("shareInfo", "url = ${info.url}")
    Log.d("shareInfo", "image = ${info.image}")
    Log.d("shareInfo", "description = ${info.description}")
    Log.d("shareInfo", "siteName = ${info.siteName}")
    Log.d("shareInfo", "type = ${info.type}")
}
```

## æ³¨æ„

1. è®°å¾—å¼€å¯js

    ```
    webView.settings.javaScriptEnabled = true
    ```
2. è¦åœ¨onPageFinishedï¼Œé¡µé¢åŠ è½½ä¹‹åè°ƒç”¨

## License

```text
Copyright (c) 2020 Kevin zhou

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

   http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
```